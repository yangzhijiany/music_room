<!DOCTYPE html>
<html>
<head>
    <title>音频测试</title>
</head>
<body>
    <h1>音频加载测试</h1>
    <button onclick="testAudio()">测试音频加载</button>
    <div id="status"></div>
    <audio id="testAudio" controls></audio>
    
    <script>
        function testAudio() {
            const status = document.getElementById('status');
            const audio = document.getElementById('testAudio');
            
            status.innerHTML = '正在获取播放URL...';
            
            fetch('http://localhost:3200/getMusicPlay?songmid=004H91MY3VB9Wp')
                .then(response => response.json())
                .then(data => {
                    if (data.data && data.data.playUrl && data.data.playUrl['004H91MY3VB9Wp']) {
                        const playUrl = data.data.playUrl['004H91MY3VB9Wp'].url;
                        status.innerHTML = '播放URL: ' + playUrl + '<br>正在设置音频源...';
                        
                        audio.src = playUrl;
                        
                        audio.addEventListener('loadstart', () => {
                            status.innerHTML += '<br>开始加载音频...';
                        });
                        
                        audio.addEventListener('canplay', () => {
                            status.innerHTML += '<br>音频可以播放！';
                        });
                        
                        audio.addEventListener('loadeddata', () => {
                            status.innerHTML += '<br>音频数据加载完成！';
                        });
                        
                        audio.addEventListener('error', (e) => {
                            status.innerHTML += '<br>音频加载错误: ' + e.message;
                            console.error('音频错误:', e);
                        });
                        
                        audio.addEventListener('stalled', () => {
                            status.innerHTML += '<br>音频加载停滞';
                        });
                        
                        audio.addEventListener('timeout', () => {
                            status.innerHTML += '<br>音频加载超时';
                        });
                        
                    } else {
                        status.innerHTML = '获取播放URL失败';
                    }
                })
                .catch(error => {
                    status.innerHTML = '请求失败: ' + error.message;
                });
        }
    </script>
</body>
</html>
